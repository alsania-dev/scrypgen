<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ScrypGen - Transform Ideas into Code</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo">
          <img src="../../assets/icons/scrypgen-logo.svg" alt="ScrypGen Logo" class="logo-img">
          <div>
              <h1>ScrypGen</h1>
              <div class="subtitle">Transform Ideas into Code</div>
          </div>
      </div>
      <div class="header-actions">
        <button class="btn" onclick="showAbout()">About</button>
      </div>
    </header>

    <main class="main-content">
      <div class="input-panel">
        <div class="input-section">
          <h2 class="section-title">Script Generation</h2>

          <div class="input-group">
            <label class="input-label" for="description"
              >Describe what your script should do:</label
            >
            <textarea
              id="description"
              class="input-field"
              placeholder="e.g., Create a Python script that reads CSV files and generates statistics..."
              rows="6"
            ></textarea>
          </div>

          <div class="input-group">
            <label class="input-label" for="language"
              >Preferred Language:</label
            >
            <select id="language" class="select-field">
              <option value="auto">ğŸ¤– Auto-detect (recommended)</option>
              <option value="python">ğŸ Python</option>
              <option value="bash">ğŸ“œ Bash</option>
            </select>
          </div>

          <div class="input-group">
            <label class="input-label">Integrations:</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="nemo" value="nemo" />
                <label for="nemo">ğŸ“ Nemo File Manager</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="kde" value="kde" />
                <label for="kde">ğŸ“± KDE Connect</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="vscode" value="vscode" />
                <label for="vscode">ğŸ’» VS Code</label>
              </div>
            </div>
          </div>

          <button
            id="generateBtn"
            class="generate-btn"
            onclick="generateScript()"
          >
            ğŸ”® Generate Script
          </button>
        </div>
      </div>

      <div class="output-panel">
        <div class="output-header">
          <h2 class="output-title">Generated Script</h2>
          <div class="output-actions">
            <button class="btn" onclick="copyToClipboard()">ğŸ“‹ Copy</button>
            <button class="btn" onclick="saveScript()">ğŸ’¾ Save</button>
          </div>
        </div>

        <div class="output-content">
          <pre id="codeDisplay" class="code-display" contenteditable="true">
// Welcome to ScrypGen!
// Describe what your script should do in the input panel,
// then click "Generate Script" to transform your ideas into code.

// Alsania Protocol v1.0 - Built by Sigma, Powered by Echo</pre
          >
        </div>

        <div class="status-panel">
          <div id="statusMessage" class="status-message">
            Ready to generate your script. Describe what you need and click
            Generate!
          </div>
        </div>
      </div>
    </main>

    <!-- Loading overlay (hidden by default) -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div>ğŸ”® Analyzing your request...</div>
      </div>
    </div>

    <div class="branding">
        <span>Powered by <a href="https://alsania.dev" target="_blank">Alsania</a></span>
    </div>

    <script>
      let currentScript = "";
      let currentLanguage = "bash";

      async function generateScript() {
        const description = document.getElementById("description").value.trim();
        if (!description) {
          showStatus("Please describe what your script should do.", "error");
          return;
        }

        const language = document.getElementById("language").value;
        const integrations = [];

        if (document.getElementById("nemo").checked)
          integrations.push({ type: "nemo", enabled: true });
        if (document.getElementById("kde").checked)
          integrations.push({ type: "kde-connect", enabled: true });
        if (document.getElementById("vscode").checked)
          integrations.push({ type: "vscode", enabled: true });

        // Show loading
        showLoading(true);
        setGenerateButtonState(false);

        try {
          const request = {
            description,
            language: language === "auto" ? undefined : language,
            integrations: integrations.length > 0 ? integrations : undefined,
            includeTests: false,
            includeDocumentation: true,
          };

          const result = await window.electronAPI.generateScript(request);

          if (result.success) {
            currentScript = result.code;
            currentLanguage = result.language;
            document.getElementById("codeDisplay").textContent = result.code;
            showStatus(
              `âœ… Script generated successfully! (${result.language.toUpperCase()})`,
              "success"
            );

            // Show warnings if any
            if (result.warnings.length > 0) {
              setTimeout(() => {
                showStatus(
                  `âš ï¸ Warnings: ${result.warnings.join(", ")}`,
                  "warning"
                );
              }, 2000);
            }
          } else {
            showStatus(
              `âŒ Generation failed: ${result.errors.join(", ")}`,
              "error"
            );
            document.getElementById("codeDisplay").textContent =
              `// Generation failed
// Errors: ${result.errors.join("\n// ")}`;
          }
        } catch (error) {
          showStatus(`âŒ Error: ${error.message}`, "error");
          console.error("Generation error:", error);
        } finally {
          showLoading(false);
          setGenerateButtonState(true);
        }
      }

      async function saveScript() {
        if (!currentScript) {
          showStatus("No script to save. Generate a script first.", "warning");
          return;
        }

        const suggestedName = `generated_script.${currentLanguage === "python" ? "py" : "sh"}`;

        try {
          const result = await window.electronAPI.saveScript(
            currentScript,
            suggestedName
          );
          if (result.success) {
            showStatus(`ğŸ’¾ Script saved to: ${result.filePath}`, "success");
          }
        } catch (error) {
          showStatus(`âŒ Save failed: ${error.message}`, "error");
        }
      }

      async function copyToClipboard() {
        if (!currentScript) {
          showStatus("No script to copy. Generate a script first.", "warning");
          return;
        }

        try {
          await navigator.clipboard.writeText(currentScript);
          showStatus("ğŸ“‹ Script copied to clipboard!", "success");
        } catch (error) {
          showStatus("âŒ Failed to copy to clipboard", "error");
        }
      }

      async function showAbout() {
        await window.electronAPI.showAbout();
      }

      function showLoading(show) {
        document.getElementById("loadingOverlay").style.display = show
          ? "flex"
          : "none";
      }

      function setGenerateButtonState(enabled) {
        const btn = document.getElementById("generateBtn");
        btn.disabled = !enabled;
        btn.textContent = enabled ? "ğŸ”® Generate Script" : "â³ Generating...";
      }

      function showStatus(message, type = "") {
        const statusEl = document.getElementById("statusMessage");
        statusEl.textContent = message;
        statusEl.className = `status-message ${type}`;
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case "Enter":
              e.preventDefault();
              generateScript();
              break;
            case "s":
              e.preventDefault();
              saveScript();
              break;
            case "c":
              if (e.shiftKey) {
                e.preventDefault();
                copyToClipboard();
              }
              break;
          }
        }
      });

      // Auto-focus description field
      document.getElementById("description").focus();
    </script>
  </body>
</html>
